---
title: "ElasticSearchã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã‚‹ : ãã®1 ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨åŸºæœ¬çš„ãªä½¿ã„æ–¹"
emoji: "ğŸ”"
type: "tech"
topics:
  - "åˆå¿ƒè€…"
  - "åˆå¿ƒè€…å‘ã‘"
  - "elasticsearch"
  - "å…¨æ–‡æ¤œç´¢"
  - "è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹"
published: true
published_at: "2024-12-09 00:10"
---

# åˆã‚ã«

ElasticSearchã«ã¤ã„ã¦ä½•ã¨ãªãã—ã‹ç†è§£ã—ã¦ãªã‹ã£ãŸã®ã§ã€è‰²ã€…ã¨èª¿ã¹ã¦ã¾ã¨ã‚ã¾ã™ã€‚
é–“é•ã£ã¦ã„ã‚‹ã¨ã“ã‚ãŒã‚ã‚Œã°ã€ã”æŒ‡æ‘˜ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€

# ElasticSearchã¨ã¯

ElasticSearchã¨ã¯ã€ã€Œé«˜é€Ÿã§æŸ”è»Ÿãªæ¤œç´¢ã‚’å¯èƒ½ã«ã™ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‹ã®å…¨æ–‡æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã€ã§ã™ã€‚
Elasticsearch ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚ã‚‰ã‚†ã‚‹ã‚µã‚¤ã‚ºã€å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿â€‹â€‹ã‚’ã»ã¼ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ¤œç´¢ã€ä½œæˆã€ä¿å­˜ã€åˆ†æã§ãã¾ã™ã€‚

- **ãƒ­ã‚°è§£æ**: ã‚·ã‚¹ãƒ†ãƒ ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’ç´ æ—©ãæ¤œç´¢ã€‚
- **å…¨æ–‡æ¤œç´¢**: å¤§é‡ã®æ–‡æ›¸ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’å¯¾è±¡ã¨ã—ãŸæ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…ã€‚
- **ECã‚µã‚¤ãƒˆã®å•†å“æ¤œç´¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ããƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ã€‚

https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro-what-is-es.html

# å…¨æ–‡æ¤œç´¢ã¨ã¯

å…¨æ–‡æ¤œç´¢ã¨ã¯ã€æ–‡æ›¸å…¨ä½“ã‚’å¯¾è±¡ã«ã—ã¦ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’æ¢ã—å‡ºã™æ¤œç´¢æ–¹æ³•ã§ã™ã€‚
å…¨æ–‡æ¤œç´¢ã«ã¯ã€ä¸»ã«**grepå‹**ã¨**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‹**ã®äºŒã¤ã®å½¢å¼ãŒã‚ã‚Šã¾ã™ã€‚

### grepå‹

**grepå‹**ã¯ã€ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã‚’é †ç•ªã«æ¤œç´¢ã—ã€æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ç®‡æ‰€ã‚’æ¢ã™æ–¹æ³•ã§ã™ã€‚
ä¾‹ãˆã°ã€UNIXã®grepã‚³ãƒãƒ³ãƒ‰ã¯ã“ã®æ–¹å¼ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
ã“ã®æ–¹å¼ã¯å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«ã§ã€å°è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã«ã¯æœ‰åŠ¹ã§ã™ãŒã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹å ´åˆã¯éåŠ¹ç‡çš„ã§ã™ã€‚

### indexå‹

ä¸€æ–¹ã€**indexå‹**ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰ã«æ§‹é€ åŒ–ã—ã¦ä¿å­˜ã—ã€æ¤œç´¢æ™‚ã«ã¯ãã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å‚ç…§ã™ã‚‹æ–¹å¼ã§ã™ã€‚
ã“ã®æ–¹æ³•ã§ã¯ã€è†¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã§ã‚‚å¿…è¦ãªæƒ…å ±ã‚’é«˜é€Ÿã«å–å¾—ã§ãã¾ã™ã€‚
ElasticSearchã¯ã“ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‹ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€ãã®é«˜é€Ÿæ€§ã‚’æ”¯ãˆã‚‹ä»•çµ„ã¿ãŒ**è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**ã§ã™ã€‚

# è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ãŒæƒ…å ±ã‚’åŠ¹ç‡çš„ã«æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚
å˜èªã”ã¨ã«ã€Œãã®å˜èªãŒã©ã“ã«ç™»å ´ã™ã‚‹ã‹ã€ã‚’è¨˜éŒ²ã—ã¦ãŠã‚Šã€æ¤œç´¢æ™‚ã«ã¯ã“ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å‚ç…§ã™ã‚‹ã ã‘ã§é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€å›³æ›¸é¤¨ã§ã€Œã‚Šã‚“ã”ã€ã¨ã„ã†è¨€è‘‰ãŒå«ã¾ã‚Œã‚‹æœ¬ã‚’æ¢ã—ãŸã„ã¨ã—ã¾ã™ã€‚
ã™ã¹ã¦ã®æœ¬ã‚’1å†Šãšã¤é–‹ã„ã¦ã€Œã‚Šã‚“ã”ã€ãŒå‡ºã¦ãã‚‹ã‹ç¢ºèªã™ã‚‹æ–¹æ³•ã§ã¯æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚
ä¸€æ–¹ã§ã€ã‚ã‚‰ã‹ã˜ã‚ã€Œã‚Šã‚“ã”ã€ã¨ã„ã†è¨€è‘‰ãŒå‡ºã¦ãã‚‹æœ¬ã®ãƒªã‚¹ãƒˆã‚’ä½œã£ã¦ãŠã‘ã°ã€ãã®ãƒªã‚¹ãƒˆã‚’å‚ç…§ã™ã‚‹ã ã‘ã§ã™ãã«è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã®ã€Œã‚ã‚‰ã‹ã˜ã‚ä½œã£ã¦ãŠã„ãŸãƒªã‚¹ãƒˆã€ãŒè»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ãŸã‚Šã¾ã™ã€‚

### è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä»•çµ„ã¿

### æ–‡ç« ã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–

å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’å˜èªï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã«åˆ†å‰²ã—ã¾ã™ã€‚
 
```md
æ–‡ç« 1: "I love ElasticSearch"
-> åˆ†å‰²çµæœï¼š`["I", "love", "ElasticSearch"]`
æ–‡ç« 2: "ElasticSearch is powerful"
-> åˆ†å‰²çµæœï¼š`["ElasticSearch", "is", "powerful"]`
æ–‡ç« 3: "I love programming"
-> åˆ†å‰²çµæœï¼š`["I", "love", "programming"]`
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ

å„å˜èªã¨ãã®å‡ºç¾ä½ç½®ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

| å˜èª            | å‡ºç¾å ´æ‰€                          |
|------------------|----------------------------------|
| I               | æ–‡ç« 1:ä½ç½®1,  æ–‡ç« 3:ä½ç½®1                    |
| love            | æ–‡ç« 1:ä½ç½®2, æ–‡ç« 3:ä½ç½®2                    |
| ElasticSearch   | æ–‡ç« 1:ä½ç½®3, æ–‡ç« 2 :ä½ç½®1,                   |
| is              | æ–‡ç« 2:ä½ç½®2                            |
| powerful        | æ–‡ç« 2:ä½ç½®3                            |
| programming     | æ–‡ç« 3:ä½ç½®3                            |

ElasticSearchã§ã¯ã€æ¤œç´¢ã‚¯ã‚¨ãƒªãŒã€Œloveã€ã®å ´åˆã€è»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å‚ç…§ã—ã¦ã€Œæ–‡ç« 1ã€ã€Œæ–‡ç« 3ã€ãŒã™ãã«è¿”å´ã•ã‚Œã¾ã™ã€‚

# ElasticSearchã®åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

ElasticSearchã¯ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªåˆ†æ•£å‹æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚Šã€è¤‡æ•°ã®ã‚µãƒ¼ãƒãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ•£ã—ã¦ç®¡ç†ã™ã‚‹ã“ã¨ã‚’å‰æã¨ã—ãŸè¨­è¨ˆãŒç‰¹å¾´ã§ã™ã€‚
åŸºæœ¬æ§‹æˆè¦ç´ ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™

**âš«ï¸Cluster**
ElasticSearchå…¨ä½“ã®ç®¡ç†å˜ä½ã§ã€è¤‡æ•°ã®Nodeã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™ã€‚
**âš«ï¸Node**
ElasticSearchã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå‹•ä½œã™ã‚‹ã‚µãƒ¼ãƒã§ã™ã€‚
Kubenetesã§è¨€ã†Podã§ã™ã€‚
**âš«ï¸Index**
Documentã®é›†åˆä½“ã®è«–ç†æ¦‚å¿µã§ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã€æ›´æ–°ã€æ¤œç´¢ã€å‰Šé™¤ã¯ã™ã¹ã¦Indexã‚’å˜ä½ã¨ã—ã¦æ“ä½œã—ã¾ã™ã€‚
**âš«ï¸Shard**
Indexã§æ“ä½œã™ã‚‹å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹ç‰©ç†å˜ä½ã§ã™ã€‚
Indexã‚’åˆ†å‰²ã—ã¦è¤‡æ•°ã®Nodeã«åˆ†æ•£é…ç½®ã•ã‚Œã¾ã™ã€‚
**âš«ï¸Document**
ElasticSearchã§ä¿å­˜ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®æœ€å°å˜ä½ã§ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã¯JSONå½¢å¼ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚
```json
{
    "id": 1,
    "name": "John Doe",
    "age": 30,
    "tags": ["developer", "engineer"]
}
```

è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ãƒ¡ãƒ«ã‚«ãƒªã®è¨˜äº‹](https://engineering.mercari.com/blog/entry/20220311-97aec2a2f8/)ãŒè©³ã—ã„ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://engineering.mercari.com/blog/entry/20220311-97aec2a2f8/

# å®Ÿéš›ã«è§¦ã£ã¦ã¿ã‚‹ 

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿéš›ã«ElasticSearchã®APIã‚’å©ã„ã¦è‰²ã€…è©¦ã—ã¦ã¿ã¾ã™ã€‚

## ãƒ­ãƒ¼ã‚«ãƒ«ã®Dockerã«ElasticSearchã‚’å°å…¥ã™ã‚‹ã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ã®Dockerã«ElasticSearchã¨ã€ŒElasticSearhã®å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ã€ã§ã‚ã‚‹**Kibana** ã‚’å°å…¥ã—ã¦ã‚·ãƒ³ã‚°ãƒ«ãƒãƒ¼ãƒ‰æ§‹æˆã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

åŸºæœ¬ã€å…¬å¼ã®æ‰‹é †ã«å¾“ã„ã¾ã™ãŒã€ElasticSerarchã®ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã®éš›ã« 
`-e "discovery.type=single-node"` ã‚’ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```sh
#  1. ElasticSearchã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’pullã—ã¦èµ·å‹•ã™ã‚‹ã€‚
docker network create elastic
docker pull docker.elastic.co/elasticsearch/elasticsearch:8.16.1
docker run --name es01 --net elastic -p 9200:9200 -it -m 2GB --rm -e "discovery.type=single-node" docker.elastic.co/elasticsearch/elasticsearch:8.16.1

# 2. Kibanaã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’pullã—ã¦èµ·å‹•ã™ã‚‹ã€‚
docker pull docker.elastic.co/kibana/kibana:8.16.1
docker run --name kib01 --net elastic -p 5601:5601 docker.elastic.co/kibana/kibana:8.16.1
```

https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_pull_the_elasticsearch_docker_image

## ElasticSearchã®APIã‚’å©ã„ã¦ã¿ã‚‹ 

Kibanaã‹ã‚‰ElasticSearchã®APIã‚’å©ãã€è‰²ã€…è©¦ã—ã¦è¦‹ã¾ã™ã€‚
Kibanaã«ã¯<http://localhost:5601>ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã¯ãšã§ã™ã€
ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±ã‚„ãƒ¦ãƒ¼ã‚¶ID/PWã‚’è¦æ±‚ã•ã‚Œã‚‹ã®ã§ã€ä¸‹è¨˜ã‚’å‚è€ƒã«æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚

```sh
# Kibanaã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«è¦æ±‚ã•ã‚Œã‚‹ç™»éŒ²ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—(å†ç”Ÿæˆ)ã™ã‚‹
docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
# Kibanaã®elasticãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—(å†ç”Ÿæˆ)ã™ã‚‹
docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
```

Kibanaã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããŸã‚‰ã€`Management > Dev Tools`ã‚’é–‹ããã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/3f06ba30e266-20241208.png)

### Indexã¨Documentã®ä½œæˆ

`PUT /$indexå`ã¨`POST /$indexå/_doc`ã‚’å®Ÿè¡Œã™ã‚‹ã¨indexã¨documentãŒä½œæˆã•ã‚Œã¾ã™ã€‚

indexã¯`POST /$indexå/_doc`æ™‚ã«å­˜åœ¨ã—ãªã„ã¨è‡ªå‹•ã§ä½œæˆã•ã‚Œã‚‹ãŸã‚ã€`PUT /$indexå`ã¯å®Ÿè¡Œã—ãªãã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```sh
# indexã®ä½œæˆ (ãªãã¦ã‚‚ã‚ˆã„)
# PUT /$indexå
PUT /my-index
# documentã®ä½œæˆ
# POST /$indexå/_doc
# bodyã«ä¿å­˜ã—ãŸã„jsonã‚’å«ã‚ã‚‹
POST /my-index/_doc
{
    "id": "park_rocky-mountain",
    "title": "Rocky Mountain",
    "description": "Bisected north to south by the Continental Divide, this portion of the Rockies has ecosystems varying from over 150 riparian lakes to montane and subalpine forests to treeless alpine tundra."
}
```

ä½œæˆã•ã‚ŒãŸdocumentã«ã¯è‡ªå‹•çš„ã«_idãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(document_id)ãŒä»˜ä¸ã•ã‚Œã¾ã™.

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "_index": "my-index",
  "_id": "eq02ppMBaR5nPaZzuWLZ",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 0,
  "_primary_term": 1
}
```
![](https://storage.googleapis.com/zenn-user-upload/3d519a9b0727-20241208.png)

:::

Documentã®ä½œæˆã¯`Bulk API`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°åŒæ™‚ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```sh
POST /_bulk
{ "index": { "_index": "my-index" } }
{ "title": "Rocky Mountain", "description": "Bisected north to south by the Continental Divide, this portion of the Rockies has ecosystems varying from over 150 riparian lakes to montane and subalpine forests to treeless alpine tundra." }
{ "index": { "_index": "my-index" } }
{ "title": "Appalachian Mountains", "description": "Stretching from Alabama to Canada, these mountains are among the oldest in the world, characterized by their gentle rolling slopes." }
{ "index": { "_index": "my-index" } }
{ "title": "Himalayas", "description": "Home to the tallest mountains on Earth, including Mount Everest, the Himalayas span five countries in South Asia." }
```

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "errors": false,
  "took": 0,
  "items": [
    {
      "index": {
        "_index": "my-index",
        "_id": "fq2kppMBaR5nPaZzPmJL",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 1,
          "failed": 0
        },
        "_seq_no": 1,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "index": {
        "_index": "my-index",
        "_id": "f62kppMBaR5nPaZzPmJL",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 1,
          "failed": 0
        },
        "_seq_no": 2,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "index": {
        "_index": "my-index",
        "_id": "gK2kppMBaR5nPaZzPmJL",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 1,
          "failed": 0
        },
        "_seq_no": 3,
        "_primary_term": 1,
        "status": 201
      }
    }
  ]
}
```
![](https://storage.googleapis.com/zenn-user-upload/8a64f4769092-20241208.png)
:::

### Documentã®æ¤œç´¢

documentã®æ¤œç´¢ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã„ã¾ã™ã€‚
matchã‚¯ã‚¨ãƒªã¯æŒ‡å®šã—ãŸå˜èªãŒã‚ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ã€‚

```sh
# documentã®æ¤œç´¢
# GET /$indexå/_seatch
# { query: { { $æ¤œç´¢ãƒ¡ã‚½ãƒƒãƒ‰ : $documentã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ : $å€¤ } }
GET /my-index/_search
{
    "query": {
        "match": {
          "title": "Appalachian"
        }
    }
}
```

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "took": 1,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.1374959,
    "hits": [
      {
        "_index": "my-index",
        "_id": "f62kppMBaR5nPaZzPmJL",
        "_score": 1.1374959,
        "_source": {
          "title": "Appalachian Mountains",
          "description": "Stretching from Alabama to Canada, these mountains are among the oldest in the world, characterized by their gentle rolling slopes."
        }
      }
    ]
  }
}
```
![](https://storage.googleapis.com/zenn-user-upload/48625ce276d6-20241208.png)
:::

ã¾ãŸã€matchã‚¯ã‚¨ãƒªã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€å®Œå…¨ä¸€è‡´ã—ãªã„æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ã§ãã¾ã™ã€‚

```sh
# documentã®æ¤œç´¢
GET /my-index/_search
{
    "query": {
        "match": {
          "title": "Appalachian is not high"
        }
    }
}
```

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "took": 3,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.1374959,
    "hits": [
      {
        "_index": "my-index",
        "_id": "f62kppMBaR5nPaZzPmJL",
        "_score": 1.1374959,
        "_source": {
          "title": "Appalachian Mountains",
          "description": "Stretching from Alabama to Canada, these mountains are among the oldest in the world, characterized by their gentle rolling slopes."
        }
      }
    ]
  }
}
```
![](https://storage.googleapis.com/zenn-user-upload/e56acabab8cd-20241208.png)
:::

ã“ã®ã‚ˆã†ãªæ¤œç´¢ãŒã§ãã‚‹ç†ç”±ã¯ã€ElasticSearchã«ã‚ˆã‚Šæ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ãŒè»¢ç½®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ¤œç´¢ã«é©ã—ãŸå½¢ã«å¤‰æ›ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼APIã‚’ä½¿ã†ã¨ã€ElasticSearchãŒã©ã®ã‚ˆã†ã«æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’è§£æã—ã¦ã„ã‚‹ã®ã‹ãŒç¢ºèªã§ãã¾ã™ã€‚

```sh
# POST /$indexå/_analyze
POST /my-index/_analyze
{
  "analyzer": "standard",
  "text": "Appalachian is not high"
}
```

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "tokens": [
    {
      "token": "appalachian",
      "start_offset": 0,
      "end_offset": 11,
      "type": "<ALPHANUM>",
      "position": 0
    },
    {
      "token": "is",
      "start_offset": 12,
      "end_offset": 14,
      "type": "<ALPHANUM>",
      "position": 1
    },
    {
      "token": "not",
      "start_offset": 15,
      "end_offset": 18,
      "type": "<ALPHANUM>",
      "position": 2
    },
    {
      "token": "high",
      "start_offset": 19,
      "end_offset": 23,
      "type": "<ALPHANUM>",
      "position": 3
    }
  ]
}
```
![](https://storage.googleapis.com/zenn-user-upload/68b5fc242c40-20241208.png)
:::


æ¤œç´¢ã‚¯ã‚¨ãƒªã«ã¯matchæ¤œç´¢ä»¥å¤–ã«ã‚‚ã€termã‚¯ã‚¨ãƒª(å®Œå…¨ä¸€è‡´)ãªã©ã€æ§˜ã€…ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

| **æ¤œç´¢æ–¹æ³•**       | **ç‰¹å¾´**                                 | **ä½¿ç”¨ä¾‹**                     |
|--------------------|------------------------------------------|--------------------------------|
| `match`            | æŸ”è»Ÿãªéƒ¨åˆ†ä¸€è‡´æ¤œç´¢                      | è‡ªç„¶è¨€èªã®æ¤œç´¢                 |
| `term`             | å®Œå…¨ä¸€è‡´æ¤œç´¢                            | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œç´¢   |
| `match_phrase`     | ãƒ•ãƒ¬ãƒ¼ã‚ºã®å®Œå…¨ä¸€è‡´æ¤œç´¢                  | å›ºæœ‰ãƒ•ãƒ¬ãƒ¼ã‚ºã®æ¤œç´¢             |
| `bool` ã‚¯ã‚¨ãƒª      | è¤‡æ•°æ¡ä»¶ã®çµ„ã¿åˆã‚ã›                   | å®Œå…¨ä¸€è‡´ã¨éƒ¨åˆ†ä¸€è‡´ã®è¤‡åˆæ¤œç´¢   |
| `wildcard`         | ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸæ¤œç´¢            | éƒ¨åˆ†ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œç´¢             |
| `prefix`           | æŒ‡å®šã—ãŸæ¥é ­è¾ã§å§‹ã¾ã‚‹æ¤œç´¢              | ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒ         |
| `regexp`           | æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æ¤œç´¢                     | è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œç´¢             |


https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html

### Index/Documentã®å‰Šé™¤

`document_id`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ç‰¹å®šã®documentã‚’å‰Šé™¤ã§ãã¾ã™ã€‚

```sh
# DELETE /$indexå/_doc/$document_id
DELETE /my-index/_doc/f62kppMBaR5nPaZzPmJL
```

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "_index": "my-index",
  "_id": "f62kppMBaR5nPaZzPmJL",
  "_version": 2,
  "result": "deleted",
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 5,
  "_primary_term": 1
}
```
![](https://storage.googleapis.com/zenn-user-upload/6e404acd1830-20241208.png)
:::

indexã¯indexåã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§å‰Šé™¤ã§ãã¾ã™ã€‚

```sh
# DELETE /$indexå
DELETE /my-index
```

:::details ãƒªã‚¹ãƒãƒ³ã‚¹
```sh
{
  "acknowledged": true
}
```
![](https://storage.googleapis.com/zenn-user-upload/8efa4dfd5d61-20241208.png)
:::

# ã¾ã¨ã‚

æœ¬è¨˜äº‹ã§ã¯ElasticSearchã®æ¦‚å¿µã¨åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ãã¾ã—ãŸã€‚
æ¬¡ã®è¨˜äº‹ã§ã¯ã€`Mapping`ã‚„`Aggregations`ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚

# å‚è€ƒ

https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html

https://engineering.mercari.com/blog/entry/20220311-97aec2a2f8/

https://qiita.com/Schott_man/items/4707973f0d6fe1d0a61f

